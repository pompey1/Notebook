# 基本着色模型

冯氏反射模型：高光specular、漫反射diffsue、环境光照ambient

# 漫反射

和观察角度无关

# 高光

与观察角度有关，通过角平分线方向的向量和法线夹角计算
![图片](./Image/07_01.png)

> 高光系数一般在布林冯模型中p是100到200

> 处理指数运算可以用快速幂算法，复杂度为logn

# 环境光

可以看做常量，需要用到全局光照知识

布林冯反射模型是基于经验，而不是真实物理规则的模型

# 着色频率

逐平面着色，效果最差，计算量最小

逐顶点着色，对颜色插值，效果中等，计算量中等

逐像素着色，对法线插值，效果最好，计算量最大

模型的面数越多，三种着色方式的差距就越小，在现代模型精度越来越高的情况下（面数甚至大于像素数），他们的优势和劣势可能互逆

法线一般在应用阶段就已经赋值（3D建模软件中称之为烘焙）

# 纹理

无缝纹理 Tilabled Texture

# 重心坐标 Barycentric Coordinates

重心坐标可以通过面积来表示，重心的重心坐标是（1/3，1/3，1/3）

对于三角形内任意一个点，都可以通过一个公式（不用记，原理就是通过面积比）得到相对于三角形三个顶点的重心坐标

相同的点和三角形在经过变换以后，点相对于三角形的重心坐标也会发生改变，所以插值计算不能直接在屏幕坐标系下计算，需要痛过逆变换将该点和三角形转换到投影之前的坐标再计算重心坐标，也可以使用透视矫正插值 

# 纹理采样 Texture sampling

纹理的采样：将离散的图片信息映射到屏幕上

默认的采样方式是Nearest采样，直接获取最近的纹理像素点颜色（本质上其实没有进行采样），不进行插值

纹理分辨率太小时会产生锯齿（原因和走样不同），此时需要用插值采样来模糊原图像

双线性插值采样 Bilinear Sampling：水平方向上做两次线性插值，垂直方向做一次线性插值（水平和垂直都做一次插值）得到像素点的颜色插值（而不是直接获取当前纹理像素的颜色）使材质贴图平滑，相当于做了一次模糊

双三次插值采样 Bicubic Sampling：非线性插值，运算量大，但是结算结果和Bilinear相比略好

纹理分辨率太大时会产生走样，本质原因和光栅化中的三角形采样一样，都是屏幕分辨率（采样频率）不够导致的，所以这里同样可以通过超采样MSAA模糊原图实现反走样

# 无采样的纹理映射 Mipmap

范围查询：图形学中的范围查询主要是获取一片范围内的平均值

Mipmap实现的范围查询：快速，但是不准确，而且只允许正方形的范围查询

映射原理：将屏幕空间的一个像素点映射到UV图中的一块面积并近似成一个正方形（通过两个像素点之间的距离计算），根据该正方形的大小选择合适Level的Mipmap，可以立即得到uv图上的颜色（类似Nearest采样）


# 三线性插值采样 Trilinear Sampling

如果Mipmap范围查询的结果不能直接定位特定的Level，则需要在不同的Level上实现三线性插值采样

在Mipmap相邻的Level上分别做一次双线性插值，再到这两个Level之间做一次线性插值

# 各向异性滤波

Overblur：传统的Mipmap会导致平行线的扭曲等overblur现象

采用各项异性可以直接范围查询一个长方形的区域，可以解决一部分overblur现象吧

采用各向异性会进一步提高贴图的占用大小，并且斜向的长方形仍然无法解决

其他滤波方法：EWA滤波

# 纹理应用（环境光照）

现代GPU中，纹理 = 内存 + 范围查询（滤波）

## 环境贴图

纹理可以用来表示环境光albedo

Sphere Map:环境光记录在一个球面上，会有扭曲问题（例如墨卡托投影的世界地图扭曲问题）

Cube Map:环境光记录在一个立方体（六个平面）上，没有扭曲问题，但是光照方向需要额外计算

## 法线贴图

法线贴图可以定义相对高度，通过贴图解压缩得到的法线进行着色，因为不改变几何信息，所以无法处理物体轮廓和阴影

在应用阶段通过对顶点求偏导得到每个顶点的切线

## 位移贴图 Displacement mapping

位移贴图会改变几何信息，但是要求模型足够细致，采样频率足够高，能够跟上纹理的变化速度

DirectX提供了动态的曲面细分，不需要应用阶段的模型足够精细，在渲染流水线的曲面细分阶段才会增加模型面数，从而提高对位移贴图的采样频率

## 3D纹理

通过三维的噪声函数可以定义一个三维的贴图

## 提前计算着色 Precompute Shading

比如环境光遮蔽贴图Ambient occlusion texture

## 3D纹理和体积渲染 Volumn Rendering